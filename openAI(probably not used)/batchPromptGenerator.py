import formatter as formatter
import json
def generate_prompts(multiple):
    count = 0
    with open("batchPrompts.jsonl", "w") as file:
        for i in formatter.data:
            if i.essential_knowledge[0:28].find(":") != -1:
                first_part_essential_knowledge = i.essential_knowledge[0:27]
            else:
                first_part_essential_knowledge = i.essential_knowledge[0:28]
            request = {
                "custom_id": f"{first_part_essential_knowledge}_{i.recommended_practice[0:20]}",
                "method": "POST",
                "url": "/v1/chat/completions",
                "body": {
                    "model": "gpt-4o-mini",
                    "messages": [
                        {"role": "system", "content": "You are an assistant that creates multiple-choice questions for AP Chemistry. In AP Chemistry there are 9 units, and each has some subunits. Each subunit has 1 or 2 learning objectives and each learning objective has 1-6 essential knowledge statements. A learning objective is denoted like 1.1.A, 1.1. A is the only learning objective for subunit 1.1. An essential knowledge statement is denoted as 1.1.A.1 or 1.1.A.2, both of which are essential knowledges for learning objective 1.1.A. There is also something called Science practices, and there are 5 sections each with a few subsections for MCQs, 1, 2, 4, 5 and 6. A science practice is denoted as 1.A or 1.B, or 5.E or 5.F. Each MCQ should have an essential knowledge statement and science practice tied to it. All of this info and the questions above are from the AP Chemistry Course and Exam Description (CED), at the link https://apcentral.collegeboard.org/media/pdf/ap-chemistry-course-and-exam-description.pdf. An example of the format you should answer in is: \"Context: 1s2 2s2 2p6 3s2 3p6, Question: Which of the following species has the electron configuration shown above? Options:(A) O, (B) Ne, (C) K+, (D) Cl+, Answer: (C), Essential Knowledge: 1.5.A.3, Question SP: 1.A\". Context would be something that would be shown above the question like a graph, table or just a string of text like shown above, or any combination of these. Another example of a question (this one with multiple objects of context) is: \"Context: HCl(aq) + CaCO3(s) → CaCl2(aq) + CO2(g) + H2O(l), The reaction between HCl(aq) and CaCO3(s) is represented by the equation above. Two separate trials were carried out using CaCO3(s) samples of the same mass, but one sample was a single piece of CaCO3(s), and one sample was composed of small pieces of CaCO3(s). The loss of mass of CaCO3(s) as a function of time for both trials is shown in the graph below. ElementDesc[Type: Graph, Specifications: Graph with the y-axis labeled 'Loss of Mass of CaCO₃(s) (g)' and the x-axis labeled 'Time (s)'. It shows two curves, labeled X and Y. Curve Y rises steeply at first, then levels off. Curve X rises more gradually and also levels off, but at a lower point than Curve Y.], Question: Which of the curves, X or Y, represents the reaction with small pieces of CaCO3(s), and why?, Options: (A), (B) Curve X, because it takes a shorter time for the reaction to go to completion due to the larger surface area of CaCO3(s), (C) Curve Y, because it shows that the reaction proceeded at a nonuniform rate, (D) Curve Y, because it takes a shorter time for the reaction to go to completion due to the larger surface area of CaCO3(s), Answer:(D), Essential Knowledge: 5.1.A.3, Question SP: 6.F\". You don't need to provide context if the question does not require it. You will be given a learning objective, essential knowledge statement, and science practice and you will be asked to generate questions. Before and after each question, there should just be one empty line (when I say question here I mean one group of ('Context', 'Question', 'Answer' and 'Explanation') . None of the questions should be numbered, even if the user asks to 'generate 5 questions...', there should just be 5 questions. If there is no context there should be 'Context: None' at the before the question. Important: Within each question, there should only be line breaks separating 'Context', 'Question', 'Answer' and 'Explanation', no other breaks. Nothing should be bolded or anything like that."},
                        {"role": "user", "content": f"Create {multiple} multiple choice questions for subunit {i.topic}, {first_part_essential_knowledge}, and {i.recommended_practice[0:20]}. The learning objective is {i.learning_objective} The essential knowledge is {i.essential_knowledge} The science practice is {i.recommended_practice} When crafting the {multiple} multiple choice questions consider the learning objective, essential knowledge, and science practice. Each question should have 4 options and an answer. For each of them, provide an explanation for the answer. Your explanation should not involve the essential knowledge, learning objective, or science practice, it should be more of an explanation of why the correct answer is correct. If the question needs some kind of diagram, you may add 'context'. Context is not always needed. It would be like a diagram, graph, or particle diagram that was needed for the problem. Things like explanations of situations do not belong in context, those can go in the question itself unless they are excessively long. Context should usually just be descriptions of diagrams, tables, or graphs. If the diagrams are makable with text, then the context can just be the diagrams. Also, context should not include some kind of prerequisite knowledge about chemistry. If there is some kind of image, graph, or table that is in context, use the shorthand ElementDesc[], filling in the square brackets with the description, to denote the element. Do not confuse context with the question itself, like I said, sometimes context isn't even needed. Create all {multiple} questions, don't stop in the middle. All of the questions need to be generated. Before and after each question, there should just be one empty line (when I say question here I mean one group of ('Context', 'Question', 'Answer' and 'Explanation'). Within each question, there should only be line breaks separating 'Context', 'Question', 'Answer' and 'Explanation', no other breaks. The questions should be relatively difficult (AP style, and like the ones provided in the system instructions), and they shouldn't be answerable with a quick glance at the Essential Knowledge. They can vary a little in difficulty though."}
                    ],
                    "temperature": 1.02,
                    "max_tokens": 16383
                }
            }
            count += 1
            file.write(json.dumps(request) + "\n")    
    return f"Generated {count*multiple} prompts"

print(generate_prompts(5))